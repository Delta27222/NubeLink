CREATE TABLE IF NOT EXISTS STORAGE_SIZE (
    ID VARCHAR(30) primary key,
    SIZE int not null
);

CREATE IF NOT EXISTS CLOUD(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	NAME VARCHAR(40) NOT NULL,
	IP_ADDRESS VARCHAR(40) NOT NULL,
	USER VARCHAR(40) NOT NULL,
	PASSWORD VARCHAR(40) NOT NULL,
	REMOTE_FILE_PATH VARCHAR(400) NOT NULL
)

CREATE TABLE IF NOT EXISTS USER(
    ID INT AUTO_INCREMENT PRIMARY KEY,
    ID_STORAGE VARCHAR(30) NOT NULL,
    ROL VARCHAR(20) NOT NULL,
    USERNAME VARCHAR(50) NOT NULL,
    PASSWORD VARCHAR(50) NOT NULL,
    FOREIGN KEY (ID_STORAGE)
        REFERENCES storage_size(ID)
        ON UPDATE RESTRICT ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS LOG(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	ID_USER INT NOT NULL,
	F_INIT DATETIME NOT NULL DEFAULT NOW(),
	F_FIN DATETIME,
	DIFF VARCHAR(30),
	FOREIGN KEY (ID_USER)
		REFERENCES USER(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE 
)

CREATE TABLE IF NOT EXISTS FILE(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	ID_USER INT NOT NULL,
	ID_CLOUD INT NOT NULL,
	NAME VARCHAR(300) NOT NULL,
	SIZE INT NOT NULL,
	REMOTE_PATH VARCAR(300) NOT NULL,
	FOREIGN KEY (ID_USER)
		REFERENCES USER(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY (ID_CLOUD)
		REFERENCES CLOUD(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE,
)

CREATE TABLE IF NOT EXISTS FOLDER(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	ID_USER INT NOT NULL,
	ID_CLOUD INT NOT NULL,
	NAME VARCHAR(300) NOT NULL,
	SIZE INT NOT NULL,
	REMOTE_PATH VARCAR(300) NOT NULL,
	FOREIGN KEY (ID_USER)
		REFERENCES USER(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY (ID_CLOUD)
		REFERENCES CLOUD(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE,
)

CREATE TABLE IF NOT EXISTS SHARED(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	ID_USER INT NOT NULL,
	ID_FOLDER INT,
	ID_FILE INT,
	ID_CLOUD INT
	FOREIGN KEY (ID_USER)
		REFERENCES USER(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY (ID_FOLDER)
		REFERENCES FOLDER(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY (ID_FILE)
		REFERENCES FILE(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY (ID_CLOUD)
		REFERENCES CLOUD(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE,
)

CREATE IF NOT EXISTS FILE_FOLDER(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	ID_FILE INT NOT NULL,
	ID_FOLDER INT NOT NULL,
	FOREIGN KEY (ID_FILE)
		REFERENCES FILE(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE,
	FOREIGN KEY (ID_FOLDER)
		REFERENCES FOLDER(ID)
		ON UPDATE RESTRICT ON DELETE CASCADE
)


